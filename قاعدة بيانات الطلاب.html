<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>قاعدة بيانات الطلاب</title>
<style>
body{
    font-family:Arial;
    direction:rtl;
    text-align:center;
    background:#1e88e5 url("https://upload.wikimedia.org/wikipedia/commons/0/0c/Coat_of_arms_of_Iraq.svg") no-repeat center;
    background-size:220px;
    color:white;
}
h1,h2,h3{margin:5px}
table{
    margin:10px auto;
    border-collapse:collapse;
}
th,td{
    border:1px solid #555;
    padding:2px;
    text-align:center;
}
input.gradeInput{
    font-size:16px;
    padding:2px;
    text-align:center;
    width:250px; /* تكبير حقل الاسم */
    margin:2px;
}
select.gradeInput{
    font-size:16px;
    padding:2px;
    text-align:center;
    width:120px;
    margin:2px;
}
input.smallInput{
    font-size:14px; /* تكبير الأرقام */
    padding:2px;
    width:35px;
    text-align:center;
}
button{
    margin:5px;
    padding:5px 10px;
    font-size:14px;
}
#adminPanel{
    display:none;
    background:#fff59d;
    color:black;
    padding:10px;
    border-radius:8px;
}
.note{
    margin-top:10px;
    font-size:12px;
    color:#b71c1c;
    font-weight:bold;
}
#resultTable{
    margin:10px auto;
    border-collapse:collapse;
    color:black;
    background:#fff59d;
    font-size:14px; /* تكبير الأرقام */
}
#resultTable th, #resultTable td{
    border:1px solid #555;
    padding:4px;
    text-align:center;
}
.resultFields input, .resultFields select{
    font-size:16px;
    text-align:center;
    margin:2px;
}
input#studentName{
    width:250px;
}
</style>
</head>

<body>

<h1>جمهورية العراق</h1>
<h2>اعدادية الشهيد عادل ناصر</h2>

<!-- البحث الخارجي -->
<div id="searchPanel">
<h3>بحث عن طالب</h3>
<input id="searchName" placeholder="أدخل اسم الطالب">
<button onclick="searchStudent()">بحث</button>
<div id="result"></div>
</div>

<hr>

<button onclick="login()">الدخول للإضافة والتعديل</button>

<!-- واجهة الإضافة -->
<div id="adminPanel">
<h2>اعدادية الشهيد عادل ناصر</h2>
<h3>واجهة التعديل والإضافة</h3>

<div class="resultFields">
<select id="grade" class="gradeInput">
  <option>الرابع</option>
  <option>الخامس</option>
  <option>السادس</option>
</select>

<select id="section" class="gradeInput">
  <option>أ</option>
  <option>ب</option>
  <option>ج</option>
</select>

<input id="studentName" placeholder="الاسم">
</div>

<!-- جدول الدرجات يظهر هنا -->
<div id="adminGrades"></div>

<button onclick="saveStudent()">حفظ / تعديل</button>

<div class="note">
ملاحظة: لا يمكن التلاعب في هذه البيانات، فقط المدير والمعاون
</div>
</div>

<script>
const adminPanel = document.getElementById("adminPanel");
const searchPanel = document.getElementById("searchPanel");
const result = document.getElementById("result");
const adminGrades = document.getElementById("adminGrades");
const studentName = document.getElementById("studentName");
const grade = document.getElementById("grade");
const section = document.getElementById("section");
const searchName = document.getElementById("searchName");

const securityCode = "karar";
let students = JSON.parse(localStorage.getItem("students")) || [];

const subjects = ["الإسلامية","العربي","الأحياء","الكيمياء","الفيزياء","الرياضيات","الحاسوب","الإنكليزي"];

function createGradesTable(student=null){
    let html = `<table id="resultTable">
        <tr>
            <th>المادة</th>
            <th>ش1</th><th>ش2</th><th>م1</th><th>نصف</th>
            <th>ش1</th><th>ش2</th><th>م2</th><th>سعي</th><th>نهائي</th>
        </tr>`;
    subjects.forEach(subj=>{
        html += `<tr>
            <td>${subj}</td>
            ${[...Array(9)].map((_,i)=>`<td><input class="smallInput" value="${student?.scores[subj]?.[i] || ''}"></td>`).join('')}
        </tr>`;
    });
    html += `</table>`;
    adminGrades.innerHTML = html;
}

function login(){
    let c = prompt("أدخل الكود الأمني");
    if(c === securityCode){
        adminPanel.style.display = "block";
        searchPanel.style.display = "none";
        createGradesTable(); 
    } else {
        alert("كود أمني غير صحيح");
    }
}

function saveStudent(){
    const nameValue = studentName.value.trim();
    if(!nameValue){ alert("يرجى إدخال اسم الطالب"); return; }

    const gradeValue = grade.value.trim();
    const sectionValue = section.value.trim();

    const tableRows = adminGrades.querySelectorAll("tr");
    let scores = {};
    tableRows.forEach((tr,i)=>{
        if(i===0) return; 
        const inputs = tr.querySelectorAll("input");
        const subj = tr.cells[0].innerText;
        scores[subj] = Array.from(inputs).map(inp => inp.value);
    });

    const student = {name:nameValue, grade:gradeValue, section:sectionValue, scores};

    const idx = students.findIndex(s => s.name.trim().toLowerCase() === nameValue.toLowerCase());
    if(idx>-1) students[idx] = student;
    else students.push(student);

    localStorage.setItem("students", JSON.stringify(students));
    alert("تم حفظ الطالب");
    adminPanel.style.display = "none";
    searchPanel.style.display = "block";
    studentName.value = "";
}

function searchStudent(){
    const searchValue = searchName.value.trim().toLowerCase();
    const s = students.find(stu => stu.name.trim().toLowerCase() === searchValue);
    
    if(!s){ 
        result.innerHTML = "الطالب غير موجود"; 
        return; 
    }

    let html = `<div class="resultFields">
        <input value="الصف: ${s.grade}" readonly>
        <input value="الشعبة: ${s.section}" readonly>
        <input value="الاسم: ${s.name}" readonly style="width:250px;">
    </div>`;

    html += `<table id="resultTable"><tr>
        <th>المادة</th>
        <th>ش1</th><th>ش2</th><th>م1</th><th>نصف</th>
        <th>ش1</th><th>ش2</th><th>م2</th><th>سعي</th><th>نهائي</th>
    </tr>`;
    for(let subj in s.scores){
        html += `<tr><td>${subj}</td>${s.scores[subj].map(v=>`<td>${v}</td>`).join('')}</tr>`;
    }
    html += `</table>`;
    result.innerHTML = html;
}
</script>

</body>
</html>